<template>
    <div>
        <head-menu></head-menu>
        <div class="container mx-auto ">
            <dl class="text-left flex items-center border-b pb-2">
                <dt>
                    <img src="@/assets/images/logo.png" alt="">
                </dt>
                <dd class="ml-5">
                    <h2 class="text-xl text-orange-500">北京家理律师事务所</h2>
                    <h2>你好！{{msg}}</h2>
                </dd>
            </dl>
            <div>
                <div class="">
                    <h2 class="md:text-3xl text-orange-500 py-4">案例上传</h2>
                    <form action="" class="w-2/3 mx-auto" enctype="multipart/form-data" >
                        <div class="text-left">
                            <span class="md:text-xl" >文件名称</span>
                            <input type="text" name="title" id="name" placeholder="请输入文件名称" v-model="formData.title" class="md:text-xl border ml-2 text-base">
                        </div>
                        <div class="text-left py-2 flex whitespace-no-wrap">
                            <span class="md:text-xl" >上传文件:</span>
                            <ul>
                                <li><input type="file" name="upfile"  id="upfile"  accept='image/jpeg, image/png, image/jpg' class="pl-2" @change="selectFile" multiple></li>
                                <li class="my-2 text-red-500">(注意：图片必须以1234……命名，切按顺序上传如：1.jpg)</li>
                            </ul>
                        </div>
                        <div id="previewImg">
                        </div>
                        <div>
                            <ul >
                                <li class="text-left my-2 w-full flex justify-between" v-for="(item, index) in filename">
                                    第{{index + 1}}个、{{item.name}} <br/>
                                    <p class="errP" v-show="isShow" >{{form.fileMsg}}</p>
                                </li>
                            </ul>
                        </div>
                        <div class="w-1/2 mx-auto pt-6">
                            <button type="submit" class="px-6 py-2 bg-blue-500 text-white" @click.prevent="submitClick()">确认上传</button>
                        </div>

                    </form>
                    <div class="my-6">
                        <a class="text-blue-500">查看已上传的文件</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
  import HeadMenu from '@/components/HeadMenu'
  import {creatCase} from '@/api/api/requestLogin.js'
  export default {
    name: "caseupload",
    components:{
      HeadMenu,
    },
   data(){
     return{
        msg:localStorage.getItem('name'),
        formData:{
          title:'',
          imgs:[]
        },
       isShow:false,
       filename:'',
       form:{
          fileMsg:'文件大小不能超过2M'
       }


     }
   },
    methods:{
      submitClick:function () {
        creatCase(this.formData).then((data)=>{
          console.log(typeof this.formData.imgs)
          this.$router.replace("/FileList");
        }).catch((data)=>{
          // console.log(data.config.headers)
          console.log(data.config.data);
          // console.log(data.config.status);
          // console.log(data.config.statusText);
          // console.log(data.config);
        })
      },
      selectFile:function () {
        let formData = new FormData();
        let imgFiles = document.getElementById("upfile").files;
        for(let i = 0; i < imgFiles.length; i++){
          formData.append('file',imgFiles[i]);
         let filePath = imgFiles[i].name;
         let fileFormat = filePath.split('.')[1].toLowerCase();
         let src = window.URL.createObjectURL(imgFiles[i]);
          console.log(src)
          if(!fileFormat.match(/png|jpg|jpeg/)){
            alert('上传错误，文件格式必须为：png/jpg/jpeg')
            return
          }
          var preview = document.getElementById('previewImg');
          var img = document.createElement('img');
          img.width = 200;
          img.height = 200;
          img.src = src;
          preview.appendChild(img);
        }
        let size;
        this.fileObj = document.getElementById("upfile").files;//获取文件信息
        let files= this.fileObj;
        this.filename = this.fileObj
        if(files && files.length){
          for (let item of files){
            let size = item.size / 1024 /1024;
            if(this.size>2){
              this.isShow = true;
              return false
            }
            this.formData.imgs.push(item.name)
          }
        }
      },
      uploadImg(){
        var files = document.getElementById('file').files;
        if(files && files.length){
          for(let item of files){
            let size=item.size / 1024 / 1024;
            if(size>2){
              this.$message.error('大小不能超过2M');
              return false
            }
            this.fileList.push(item['name']);
            this.files.push(item);
          }
        }
      },
      deleteFile(index) {
        var dom = document.getElementById('file');
        dome.value == ''
        this.fileList.splice(index, 1);
        this.Files.splice(index, 1);
      }
    }

  }
</script>

<style scoped>

</style>
